<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link
            rel="stylesheet"
            type="text/css"
            href="{{ url_for('static',filename='styles/style.css') }}"
        />
        <link rel="stylesheet" href="static/styles/style.css" />

        <title>Weather Classifier</title>
    </head>
    <body>
        <h1>Weather Classifier</h1>

        <div class="select-img">
            <p id="prompt">Choose an image of a weather condition!</p>
            <form
                id="file-upload-form"
                action="{{ url_for('upload') }}"
                method="post"
                enctype="multipart/form-data"
            >
                <div class="file-select-btn">
                    <label for="file-selector">Select Image</label><br />
                    <input
                        type="file"
                        id="file-selector"
                        name="file"
                        accept=".jpg, .jpeg, .png, .gif, .bmp"
                        onchange="previewImage()"
                        hidden="true"
                    />
                    <span id="chosen-file"
                        >{% if img != None %} {{img}} {% endif %}</span
                    >
                </div>

                <br />
                <div id="image-preview">
                    {% if img != None %}
                    <img
                        src="{{ url_for('uploaded_file', filename=img) }}"
                        alt="Uploaded Image"
                    />
                    {% else %}
                    <div id="drop-area">
                        <img id="upload-img" src="{{ url_for('static',
                        filename="./img/upload.gif") }}" alt="Upload" />
                        <p id="drop-msg">Drop an image</p>
                        <input
                            type="file"
                            id="file-selector-dd"
                            name="file"
                            accept=".jpg, .jpeg, .png, .gif, .bmp"
                            onchange="previewImage('file-selector-dd')"
                            hidden="true"
                        />
                    </div>
                    {% endif %}
                </div>
                <input
                    id="predict"
                    type="submit"
                    name="action"
                    value="Predict"
                />
            </form>
        </div>

        <p id="result">
            {% if pred_result and pred_conf != "" %} There is a {{ pred_conf }}%
            that the image features
            <b> {{ pred_result }} </b> weather {% endif %}
        </p>

        <script>
            const predictBtn = document.getElementById("predict");
            const chosenFile = document.getElementById("chosen-file");
            const resultMsg = document.getElementById("result");

            predictBtn.style.display = "none";

            function previewImage(inputId = "file-selector") {
                console.log(inputId);
                predictBtn.style.display = "inline-block";
                const fileInput = document.getElementById(inputId);
                const imagePreview = document.getElementById("image-preview");

                let uploadFile = fileInput.files;

                // clear previous view
                imagePreview.innerHTML = "";
                resultMsg.innerHTML = "";

                // Check if a file is selected
                if (uploadFile && uploadFile[0]) {
                    const reader = new FileReader();

                    reader.onload = function (e) {
                        // create img element
                        const img = document.createElement("img");
                        img.src = e.target.result;
                        imagePreview.appendChild(img);
                    };

                    // read selected file
                    reader.readAsDataURL(uploadFile[0]);
                    chosenFile.innerHTML = uploadFile[0].name;
                }
            }

            const dropArea = document.getElementById("image-preview");
            const fileSelector = document.getElementById("file-selector");

            dropArea.addEventListener("dragover", (e) => {
                e.preventDefault();
                dropArea.style.border = "2px dashed #333";
            });

            dropArea.addEventListener("dragleave", () => {
                dropArea.style.border = "2px dashed #ccc";
            });

            dropArea.addEventListener("drop", (e) => {
                e.preventDefault();
                dropArea.style.border = "2px dashed #ccc";
                const files = e.dataTransfer.files;
                handleFiles(files);
            });

            function handleFiles(file) {
                // fire change event on the button file selector
                fileSelector.files = file;
                fileSelector.dispatchEvent(new Event("change"));
            }
        </script>
    </body>
</html>
